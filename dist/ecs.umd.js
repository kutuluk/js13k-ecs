!function(t,n){"object"==typeof exports&&"undefined"!=typeof module?module.exports=n():"function"==typeof define&&define.amd?define(n):t.ecs=n()}(this,function(){var t=[],n=[],e={},r="_sign",o="_mask";"undefined"!=typeof Symbol&&(r=Symbol(r),o=Symbol(o));var i=function(t,n){var e=n[t];if(!e)throw new Error("The component is not registered");return e},s=i.bind(null,r),c=i.bind(null,o),u=function(n){n.id&&t.forEach(function(t){return t.match(n)})},a=1,f={},h=function(t){this.id=t||(a++).toString(36),this.components=Object.assign({},f),this.mask=0};h.prototype.add=function(){for(var t=this,n=[],e=arguments.length;e--;)n[e]=arguments[e];n.forEach(function(n){t.components[s(n.constructor)]=n,t.mask|=c(n.constructor)}),u(this)},h.prototype.remove=function(){for(var t=this,n=[],e=arguments.length;e--;)n[e]=arguments[e];n.forEach(function(n){var e=s(n),r=t.components[e];r&&(r.destructor&&r.destructor(),delete t.components[e],t.mask&=~c(n))}),u(this)},h.prototype.has=function(t){return s(t)in this.components},h.prototype.get=function(t){return this.components[t[r]]},h.prototype.eject=function(){var n;n=this,Object.values(n.components).forEach(function(t){return t&&t.destructor&&t.destructor()}),t.forEach(function(t){return t.remove(n)}),delete e[n.id],n.id=0};var p=function(t,n){this.entity=t,this.prev=null,this.next=n},d=function(t){var n=this;if(!t)throw new Error("Empty selector");this.mask=t,this.map={},this.list=null,this.length=0,Object.values(e).forEach(function(t){return n.match(t)})};d.prototype.iterate=function(t){for(var n=this.list;n;)t(n.entity),n=n.next},d.prototype.match=function(t){(this.mask&t.mask)===this.mask?this.add(t):this.remove(t)},d.prototype.add=function(t){if(!this.map[t.id]){var n=new p(t,this.list);this.list&&(this.list.prev=n),this.list=n,this.map[t.id]=n,this.length++}},d.prototype.remove=function(t){var n=this.map[t.id];n&&(n.prev?n.prev.next=n.next:this.list=n.next,n.next&&(n.next.prev=n.prev),delete this.map[t.id],this.length--)};var m=0,l=performance||Date,v=l.now.bind(l);return{register:function(){for(var t=[],n=arguments.length;n--;)t[n]=arguments[n];t.forEach(function(t){if(m>31)throw new Error("Components limit reached");if(!t[r]){var n=m.toString(36);f[n]=null,t[r]=n,t[o]=1<<m,m++}})},process:function(){for(var t=[],e=arguments.length;e--;)t[e]=arguments[e];t.forEach(function(t){return n.push(t)})},create:function(t){var n=new h(t);if(e[n.id])throw new Error("The ID already exist");return e[n.id]=n,n},get:function(t){return e[t]},select:function(){for(var n=[],e=arguments.length;e--;)n[e]=arguments[e];var r=0;n.forEach(function(t){r|=c(t)});var o=t.find(function(t){return t.mask===r});if(o)return o;var i=new d(r);return t.push(i),i},update:function(t){var e={};return n.forEach(function(n){var r=v();n.update(t),e[n.constructor.name]=v()-r}),e}}});
