!function(t,n){"object"==typeof exports&&"undefined"!=typeof module?module.exports=n():"function"==typeof define&&define.amd?define(n):t.ecs=n()}(this,function(){var t=[],n=[],e={},r="_sign",o="_mask";"undefined"!=typeof Symbol&&(r=Symbol(r),o=Symbol(o));var i=function(t,n){var e=n[t];if(!e)throw new Error("The component is not registered");return e},s=i.bind(null,r),c=i.bind(null,o),a=function(n){n.id&&t.forEach(function(t){return t.match(n)})},f=1,h={},u=function(t){this.id=t||(f++).toString(36),this.components=Object.assign({},h),this.mask=0};u.prototype.add=function(){for(var t=this,n=[],e=arguments.length;e--;)n[e]=arguments[e];n.forEach(function(n){t.components[s(n.constructor)]=n,t.mask|=c(n.constructor)}),a(this)},u.prototype.remove=function(){for(var t=this,n=[],e=arguments.length;e--;)n[e]=arguments[e];n.forEach(function(n){var e=s(n),r=t.components[e];r&&(r.destructor&&r.destructor(),delete t.components[e],t.mask&=~c(n))}),a(this)},u.prototype.has=function(t){return s(t)in this.components},u.prototype.get=function(t){return this.components[t[r]]},u.prototype.eject=function(){!function(n){for(var r in n)if(Object.prototype.hasOwnProperty.call(n,r)){var o=n[r];o&&o.destructor&&o.destructor()}t.forEach(function(t){return t.remove(n)}),delete e[n.id],n.id=0}(this)};var p=function(t,n){this.entity=t,this.prev=null,this.next=n},l=function(t){if(!t)throw new Error("Empty selector");for(var n in this.mask=t,this.map={},this.list=null,this.length=0,e)Object.prototype.hasOwnProperty.call(e,n)&&this.match(e[n])};l.prototype.iterate=function(t){for(var n=this.list;n;)t(n.entity),n=n.next},l.prototype.match=function(t){(this.mask&t.mask)===this.mask?this.add(t):this.remove(t)},l.prototype.add=function(t){if(!this.map[t.id]){var n=new p(t,this.list);this.list&&(this.list.prev=n),this.list=n,this.map[t.id]=n,this.length++}},l.prototype.remove=function(t){var n=this.map[t.id];n&&(n.prev?n.prev.next=n.next:this.list=n.next,n.next&&(n.next.prev=n.prev),delete this.map[t.id],this.length--)};var d=0,m=performance||Date,v=m.now.bind(m);return{register:function(){for(var t=[],n=arguments.length;n--;)t[n]=arguments[n];t.forEach(function(t){if(d>31)throw new Error("Components limit reached");if(!t[r]){var n=d.toString(36);h[n]=null,t[r]=n,t[o]=1<<d,d++}})},process:function(){for(var t=[],e=arguments.length;e--;)t[e]=arguments[e];t.forEach(function(t){return n.push(t)})},create:function(t){var n=new u(t);if(e[n.id])throw new Error("The ID already exist");return e[n.id]=n,n},get:function(t){return e[t]},select:function(){for(var n=[],e=arguments.length;e--;)n[e]=arguments[e];var r=0;n.forEach(function(t){r|=c(t)});for(var o=0;o<t.length;o++)if(t[o].mask===r)return t[o];var i=new l(r);return t.push(i),i},update:function(t){var e={};return n.forEach(function(n){var r=v();n.update(t),e[n.constructor.name]=v()-r}),e}}});
